import React, { useState, useEffect } from 'react';

// Icons from lucide-react, assuming it's available in the environment
const FoodIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-soup">
    <path d="M12 21a9 9 0 0 0 9-9V6H3v6a9 9 0 0 0 9 9Z"/><path d="M7 12h10"/><path d="M12 3v3"/>
  </svg>
);
const CarIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-truck">
    <path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M10 18h6a2 2 0 0 0 2-2v-2h3l3 3v2h1a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1h-1.5a1.5 1.5 0 0 0-1.5 1.5V17a1.5 1.5 0 0 0 1.5 1.5H22"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/>
  </svg>
);
const DollarSignIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-dollar-sign">
    <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
  </svg>
);
const TrendingUpIcon = () => (
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-trending-up">
    <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/>
  </svg>
);

const App = () => {
  // å¹³å°æŠ½æˆæ•¸æ“š
  const commissionRates = {
    foodpanda: {
      trial: 0.27, // 27%
      original: 0.33, // 33%
    },
    ubereats: {
      trial: 0.28, // 28%
      original: 0.33, // 33%
    },
  };

  // ç‹€æ…‹è®Šæ•¸
  const [platform, setPlatform] = useState('foodpanda'); // foodpanda æˆ– ubereats
  const [rateType, setRateType] = useState('trial'); // trial (è©¦ç”¨æœŸ) æˆ– original (åŸè²»ç‡)
  const [inStorePrice, setInStorePrice] = useState(''); // åº—å…§åƒ¹æ ¼
  const [itemCost, setItemCost] = useState(''); // å•†å“æˆæœ¬
  const [desiredProfit, setDesiredProfit] = useState(''); // é æœŸåˆ©æ½¤ç™¾åˆ†æ¯”

  const [basicResult, setBasicResult] = useState(''); // åŸºæœ¬è©¦ç®—çµæœ
  const [advancedResult, setAdvancedResult] = useState(''); // é€²éšåˆ©æ½¤å®šåƒ¹çµæœ
  const [basicError, setBasicError] = useState(''); // åŸºæœ¬è©¦ç®—éŒ¯èª¤è¨Šæ¯
  const [advancedError, setAdvancedError] = useState(''); // é€²éšåˆ©æ½¤å®šåƒ¹éŒ¯èª¤è¨Šæ¯

  // æ ¹æ“šé¸æ“‡çš„å¹³å°å’Œè²»ç‡é¡å‹ç²å–ç•¶å‰æŠ½æˆæ¯”ä¾‹
  const getCurrentCommission = () => {
    return commissionRates[platform][rateType];
  };

  // è™•ç†åŸºæœ¬å®šåƒ¹è©¦ç®—
  const calculateBasicPricing = () => {
    const price = parseFloat(inStorePrice);
    const commission = getCurrentCommission();

    setBasicError('');
    if (isNaN(price) || price <= 0) {
      setBasicError('è«‹è¼¸å…¥æœ‰æ•ˆçš„åº—å…§åƒ¹æ ¼ (å¿…é ˆç‚ºæ­£æ•¸)ã€‚');
      setBasicResult('');
      return;
    }

    if (commission >= 1) { // æŠ½æˆä¸å¯èƒ½å¤§æ–¼ç­‰æ–¼100%
      setBasicError('æŠ½æˆæ¯”ä¾‹ç•°å¸¸ï¼Œç„¡æ³•è¨ˆç®—ã€‚');
      setBasicResult('');
      return;
    }

    const platformPrice = price / (1 - commission);
    setBasicResult(platformPrice.toFixed(2)); // ä¿ç•™å…©ä½å°æ•¸
  };

  // è™•ç†é€²éšåˆ©æ½¤å®šåƒ¹
  const calculateAdvancedPricing = () => {
    const cost = parseFloat(itemCost);
    const profitPercentage = parseFloat(desiredProfit) / 100; // è½‰æ›ç‚ºå°æ•¸
    const commission = getCurrentCommission();

    setAdvancedError('');
    if (isNaN(cost) || cost <= 0) {
      setAdvancedError('è«‹è¼¸å…¥æœ‰æ•ˆçš„å•†å“æˆæœ¬ (å¿…é ˆç‚ºæ­£æ•¸)ã€‚');
      setAdvancedResult('');
      return;
    }
    if (isNaN(profitPercentage) || profitPercentage < 0) {
      setAdvancedError('è«‹è¼¸å…¥æœ‰æ•ˆçš„é æœŸåˆ©æ½¤ç™¾åˆ†æ¯” (å¿…é ˆç‚ºéè² æ•¸)ã€‚');
      setAdvancedResult('');
      return;
    }

    if (commission + profitPercentage >= 1) {
      setAdvancedError('é æœŸåˆ©æ½¤èˆ‡å¹³å°æŠ½æˆä¹‹å’Œä¸èƒ½å¤§æ–¼æˆ–ç­‰æ–¼ 100%ã€‚è«‹èª¿æ•´æ‚¨çš„åˆ©æ½¤ç›®æ¨™æˆ–æˆæœ¬ã€‚');
      setAdvancedResult('');
      return;
    }

    const platformPrice = cost / (1 - commission - profitPercentage);
    setAdvancedResult(platformPrice.toFixed(2)); // ä¿ç•™å…©ä½å°æ•¸
  };

  // ç•¶ä»»ä½•è¼¸å…¥æˆ–é¸æ“‡æ”¹è®Šæ™‚ï¼Œé‡æ–°è¨ˆç®—
  useEffect(() => {
    calculateBasicPricing();
  }, [inStorePrice, platform, rateType]);

  useEffect(() => {
    calculateAdvancedPricing();
  }, [itemCost, desiredProfit, platform, rateType]);

  // æ ¹æ“šé¸æ“‡çš„å¹³å°ç”Ÿæˆå‚™è¨»æ–‡å­—
  const getCommissionRemark = () => {
    const foodpandaTrial = commissionRates.foodpanda.trial * 100;
    const foodpandaOriginal = commissionRates.foodpanda.original * 100;
    const ubereatsTrial = commissionRates.ubereats.trial * 100;
    const ubereatsOriginal = commissionRates.ubereats.original * 100;

    if (platform === 'foodpanda') {
      return `foodpanda å¹³å°æŠ½æˆï¼šè©¦ç”¨æœŸ ${foodpandaTrial}% (å‰ä¸‰å€‹æœˆ)ï¼ŒåŸè²»ç‡ ${foodpandaOriginal}%`;
    } else if (platform === 'ubereats') {
      return `Uber Eats å¹³å°æŠ½æˆï¼šè©¦ç”¨æœŸ ${ubereatsTrial}% (å‰å…­å€‹æœˆ)ï¼ŒåŸè²»ç‡ ${ubereatsOriginal}%`;
    }
    return '';
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 p-4 font-['Inter'] flex flex-col items-center justify-center">
      <div className="w-full max-w-4xl bg-white p-8 rounded-xl shadow-2xl space-y-8 border-t-4 border-indigo-400">
        <h1 className="text-4xl font-extrabold text-center text-indigo-700 mb-8 tracking-tight">
          <DollarSignIcon className="inline-block mr-3 align-text-bottom" />
          å¤–é€å¹³å°å®šåƒ¹è¨ˆç®—å™¨
        </h1>

        {/* å¹³å°èˆ‡è²»ç‡é¸æ“‡å€ */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 p-6 bg-indigo-50 rounded-lg shadow-inner">
          {/* å¹³å°é¸æ“‡ */}
          <div>
            <h2 className="text-2xl font-semibold text-indigo-600 mb-3 flex items-center">
              <FoodIcon className="mr-2" />
              é¸æ“‡å¹³å°
            </h2>
            <div className="flex flex-wrap gap-4">
              <label className="inline-flex items-center cursor-pointer">
                <input
                  type="radio"
                  className="form-radio h-5 w-5 text-indigo-600 rounded-full focus:ring-indigo-500"
                  name="platform"
                  value="foodpanda"
                  checked={platform === 'foodpanda'}
                  onChange={() => setPlatform('foodpanda')}
                />
                <span className="ml-2 text-lg font-medium text-gray-800">foodpanda</span>
              </label>
              <label className="inline-flex items-center cursor-pointer">
                <input
                  type="radio"
                  className="form-radio h-5 w-5 text-indigo-600 rounded-full focus:ring-indigo-500"
                  name="platform"
                  value="ubereats"
                  checked={platform === 'ubereats'}
                  onChange={() => setPlatform('ubereats')}
                />
                <span className="ml-2 text-lg font-medium text-gray-800">Uber Eats</span>
              </label>
            </div>
          </div>

          {/* è²»ç‡é¸æ“‡ */}
          <div>
            <h2 className="text-2xl font-semibold text-indigo-600 mb-3 flex items-center">
              <TrendingUpIcon className="mr-2" />
              é¸æ“‡è²»ç‡
            </h2>
            <div className="flex flex-wrap gap-4">
              <label className="inline-flex items-center cursor-pointer">
                <input
                  type="radio"
                  className="form-radio h-5 w-5 text-indigo-600 rounded-full focus:ring-indigo-500"
                  name="rateType"
                  value="trial"
                  checked={rateType === 'trial'}
                  onChange={() => setRateType('trial')}
                />
                <span className="ml-2 text-lg font-medium text-gray-800">è©¦ç”¨æœŸè²»ç‡ ({getCurrentCommission() * 100}%)</span>
              </label>
              <label className="inline-flex items-center cursor-pointer">
                <input
                  type="radio"
                  className="form-radio h-5 w-5 text-indigo-600 rounded-full focus:ring-indigo-500"
                  name="rateType"
                  value="original"
                  checked={rateType === 'original'}
                  onChange={() => setRateType('original')}
                />
                <span className="ml-2 text-lg font-medium text-gray-800">åŸè²»ç‡ ({getCurrentCommission() * 100}%)</span>
              </label>
            </div>
            {/* è²»ç‡å‚™è¨»æ¬„ */}
            <p className="text-sm text-gray-500 mt-3 p-2 bg-indigo-100 rounded-md">
              å‚™è¨»ï¼š{getCommissionRemark()}
            </p>
          </div>
        </div>

        {/* åŸºæœ¬å®šåƒ¹è©¦ç®—å€å¡Š */}
        <div className="bg-white p-6 rounded-xl shadow-md border border-gray-200">
          <h2 className="text-3xl font-bold text-gray-800 mb-4 flex items-center">
            <span className="bg-purple-100 p-2 rounded-full mr-3">ğŸ’°</span>
            åŸºæœ¬å®šåƒ¹è©¦ç®— (ä¸è™§éŒ¢)
          </h2>
          <p className="text-gray-600 mb-5">è¼¸å…¥åº—å…§åƒ¹æ ¼ï¼Œè¨ˆç®—å¤–é€å¹³å°å»ºè­°å”®åƒ¹ï¼Œä»¥ç¢ºä¿æ‰£é™¤æŠ½æˆå¾Œèƒ½æ”¶å›åº—å…§åƒ¹æ ¼ã€‚</p>
          <div className="mb-4">
            <label htmlFor="inStorePrice" className="block text-xl font-medium text-gray-700 mb-2">
              åº—å…§åƒ¹æ ¼ (å…ƒ)ï¼š
            </label>
            <input
              type="number"
              id="inStorePrice"
              className="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-lg"
              placeholder="ä¾‹å¦‚ï¼š100"
              value={inStorePrice}
              onChange={(e) => setInStorePrice(e.target.value)}
            />
            {basicError && <p className="text-red-500 text-sm mt-2">{basicError}</p>}
          </div>
          <div className="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
            <p className="text-lg text-indigo-700 font-semibold flex items-center">
              <span className="text-indigo-500 mr-2">âœ</span> å¤–é€å¹³å°å»ºè­°å”®åƒ¹ï¼š
              <span className="text-indigo-800 text-2xl font-bold ml-2">
                {basicResult ? `${basicResult} å…ƒ` : 'è«‹è¼¸å…¥æ•¸å­—'}
              </span>
            </p>
          </div>
        </div>

        {/* é€²éšåˆ©æ½¤å®šåƒ¹å€å¡Š */}
        <div className="bg-white p-6 rounded-xl shadow-md border border-gray-200 mt-8">
          <h2 className="text-3xl font-bold text-gray-800 mb-4 flex items-center">
            <span className="bg-green-100 p-2 rounded-full mr-3">ğŸ“ˆ</span>
            é€²éšåˆ©æ½¤å®šåƒ¹ (å«é æœŸåˆ©æ½¤)
          </h2>
          <p className="text-gray-600 mb-5">è¼¸å…¥å•†å“æˆæœ¬åŠé æœŸåˆ©æ½¤ç™¾åˆ†æ¯”ï¼Œè¨ˆç®—å¤–é€å¹³å°å»ºè­°å”®åƒ¹ï¼Œä»¥é”åˆ°æ‚¨çš„åˆ©æ½¤ç›®æ¨™ã€‚</p>
          <div className="mb-4">
            <label htmlFor="itemCost" className="block text-xl font-medium text-gray-700 mb-2">
              å•†å“æˆæœ¬ (å…ƒ)ï¼š
            </label>
            <input
              type="number"
              id="itemCost"
              className="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-lg"
              placeholder="ä¾‹å¦‚ï¼š50"
              value={itemCost}
              onChange={(e) => setItemCost(e.target.value)}
            />
            {advancedError && itemCost && <p className="text-red-500 text-sm mt-2">{advancedError}</p>}
          </div>
          <div className="mb-4">
            <label htmlFor="desiredProfit" className="block text-xl font-medium text-gray-700 mb-2">
              é æœŸåˆ©æ½¤ç™¾åˆ†æ¯” (%)ï¼š
            </label>
            <input
              type="number"
              id="desiredProfit"
              className="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-lg"
              placeholder="ä¾‹å¦‚ï¼š30"
              value={desiredProfit}
              onChange={(e) => setDesiredProfit(e.target.value)}
            />
             {advancedError && desiredProfit && <p className="text-red-500 text-sm mt-2">{advancedError}</p>}
          </div>
          <div className="bg-green-50 p-4 rounded-lg border border-green-200">
            <p className="text-lg text-green-700 font-semibold flex items-center">
              <span className="text-green-500 mr-2">âœ</span> å¤–é€å¹³å°å»ºè­°å”®åƒ¹ï¼š
              <span className="text-green-800 text-2xl font-bold ml-2">
                {advancedResult ? `${advancedResult} å…ƒ` : 'è«‹è¼¸å…¥æ•¸å­—'}
              </span>
            </p>
          </div>
          {advancedError && (!itemCost || !desiredProfit) && <p className="text-red-500 text-sm mt-2">{advancedError}</p>}
        </div>
      </div>
    </div>
  );
};
